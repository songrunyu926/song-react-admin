<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <button id="btn1">按钮1</button>
  <button id="btn2">按钮2</button>
  <button id="btn3">按钮3</button>
  <script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
  <script>
    //使用axios发送请求
    const btn1 = document.getElementById('btn1')
    const btn2 = document.getElementById('btn2')
    const btn3 = document.getElementById('btn3')

    let token = ''

    //使用axios.create方法 创建一个axios对象 里面可以配置一些公共配置
    //axiosInstance 就是axios的实例 用法基本一致
    const axiosInstance = axios.create({
      baseURL: 'http://localhost:5000/api/',
      timeout: 10000,  //发送请求的限制时间
      headers: {
        //公共的请求头
      }
    })

    axios.interceptors.request.use(config => {
    // Do something before request is sent
    return config;
    },error => {
    // Do something with request error
    return Promise.reject(error);
    });

    //axios请求拦截器  请求拦截器: 在axios发送请求之前触发的拦截器回调函数
    axiosInstance.interceptors.request.use(config => {
      // 将要发送请求是成功的（内部没有出错）触发回调函数 
      //功能就是修改请求信息
      console.log(config)
      //1 当post请求时，请求参数格式为 x-www-form-urlencoded
      if(config.method === 'post'){
        config.headers['content-type'] = 'application/x-www-form-urlencoded'
        //修改data 数据变成字符串  让我们可以传入对象
        config.data = Object.keys(config.data).reduce((p,key) => {
          const value = config.data[key]
          return p + `&${key}=${value}`
        },'').substring(1)
      }
      //当有token时，自动传入token
      if(token){
        config.headers.authorization = 'Bearer ' + token
      }
    return config;
    },error => {
    // Do something with request error
    return Promise.reject(error);
    });

    btn1.onclick = () => {
      axiosInstance({
        method: 'POST',
        url: 'login',
        data: {
          username: 'admin',
          password: 'admin'
        }  
      })
      .then(res => {
        if(res.data.status === 0){
          console.log('登陆成功')
          token = res.data.data.token
          console.log(token)
        }else{
          console.log('登录失败')
        }
      })
      .catch(err => {
        console.log(err)
        alert('网络故障！')
      })
    }
  
    btn2.onclick = () => {
      axiosInstance({
        method: 'GET',
        url: 'category/get',
      })
      .then(res => {
        if(res.data.status === 0){
          console.log('请求分类列表成功')
          console.log(res.data)
        }else{
          console.log('登录失败')
        }
      })
      .catch(err => {
        console.log(err)
        alert('网络故障！')
      })
    }

    btn3.onclick = () => {
      axiosInstance({
        method: 'POST',
        url: 'category/add',
        data: {
          categoryName: '电动娃娃'
        },
      })
      .then(res => {
        if(res.data.status === 0){
          console.log('添加分类成功')
        }else{
          console.log('添加失败')
        }
      })
      .catch(err => {
        console.log(err)
        alert('网络故障！')
      })
    }
  </script>
</body>
</html>
